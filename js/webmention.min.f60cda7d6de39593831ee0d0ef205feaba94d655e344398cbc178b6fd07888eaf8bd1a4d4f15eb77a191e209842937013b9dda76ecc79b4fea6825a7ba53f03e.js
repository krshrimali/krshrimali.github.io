(function(){"use strict";function e(e,t){return document.currentScript.getAttribute("data-"+e)||t}var p=e("page-url",window.location.href.replace(/#.*$/,"")),o=e("add-urls",void 0),f=e("data-id","webmentions"),n=e("wordcount"),m=e("max-webmentions",30),a=e("prevent-spoofing")?"wm-source":"url",h=e("sort-by","published"),u=e("sort-dir","up"),l={"in-reply-to":"replied","like-of":"liked","repost-of":"reposted","bookmark-of":"bookmarked","mention-of":"mentioned",rsvp:"RSVPed","follow-of":"followed"},d={"in-reply-to":"💬","like-of":"❤️","repost-of":"🔄","bookmark-of":"⭐️","mention-of":"💬",rsvp:"📅","follow-of":"🐜"},c={yes:"✅",no:"❌",interested:"💡",maybe:"💭"};function t(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function i(e){var s=t(e.author&&e.author.name?e.author.name:e.url.split("/")[2]),o=l[e["wm-property"]]||"reacted",n='<a class="reaction" rel="nofollow ugc" title="'+s+" "+o+'" href="'+e[a]+'">';return e.author&&e.author.photo&&(n+='<img src="'+t(e.author.photo)+'">'),n+=d[e["wm-property"]]||"💥",e.rsvp&&c[e.rsvp]&&(n+="<sub>"+c[e.rsvp]+"</sub>"),n+="</a>",n}function s(e){return e.substr(e.indexOf("//"))}function r(e){var t=[],n={};return e.forEach(function(e){var o=s(e.url);n[o]||(t.push(e),n[o]=!0)}),t}function g(e){var s="<h2>"+e.length+" Response"+(e.length>1?"s":"")+'</h2><ul class="comments">';return e.forEach(function(e){if(s+="<li>",s+=i(e),s+=' <a class="source" rel="nofollow ugc" href="'+e[a]+'">',e.author&&e.author.name?s+=t(e.author.name):s+=t(e.url.split("/")[2]),s+="</a>: ",e.name)r="name",c=e.name;else if(e.content&&e.content.text){var o,r,c,l=t(e.content.text);n&&(o=l.replace(/\s+/g," ").split(" ",n+1),o.length>n&&(o[n-1]+="&hellip;",o=o.slice(0,n),l=o.join(" "))),r="text",c=l}else r="name",c="(mention)";s+='<span class="'+r+'">'+c+"</span>",s+="</li>"}),s+="</ul>",s}function v(e){var t="<h2>"+e.length+" Reaction"+(e.length>1?"s":"")+'</h2><ul class="reacts">';return e.forEach(function(e){t+=i(e)}),t}function b(e,t){if(window.fetch)window.fetch(e).then(function(e){return e.status>=200&&e.status<300?Promise.resolve(e):Promise.reject(new Error(e.statusText))}).then(function(e){return e.json()}).then(t).catch(function(e){console.error("Request failed",e)});else{var n=new XMLHttpRequest;n.onload=function(e){t(JSON.parse(e))},n.onerror=function(e){console.error("Request failed",e)}}}window.addEventListener("load",function(){var e,t,n=document.getElementById(f);if(!n)return;e=[s(p)],!o||o.split("|").forEach(function(t){e.push(s(t))}),t="https://webmention.io/api/mentions.jf2?per-page="+m+"&sort-by="+h+"&sort-dir="+u,e.forEach(function(e){t+="&target[]="+encodeURIComponent("http:"+e)+"&target[]="+encodeURIComponent("https:"+e)}),b(t,function(e){var o="",t=[],s=[],i={"in-reply-to":t,"like-of":s,"repost-of":s,"bookmark-of":s,"mention-of":t,rsvp:t};e.children.forEach(function(e){var t=i[e["wm-property"]];t&&t.push(e)}),t.length>0&&(o+=g(r(t))),s.length>0&&(o+=v(r(s))),n.innerHTML=o})})})()