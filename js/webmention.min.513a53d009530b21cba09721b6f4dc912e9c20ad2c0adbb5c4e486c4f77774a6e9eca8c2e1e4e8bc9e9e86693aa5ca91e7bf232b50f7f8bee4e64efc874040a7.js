(function(){"use strict";var o,e,m,b,l,g,j,i,h,k,f;function a(a,b){return document.currentScript.getAttribute("data-"+a)||b}o=a("page-url",window.location.href.replace(/#.*$/,"")),e=a("add-urls",void 0),m=a("data-id","webmentions"),b=a("wordcount"),l=a("max-webmentions",30),g=a("prevent-spoofing")?"wm-source":"url",j=a("sort-by","published"),i=a("sort-dir","up"),h={"in-reply-to":"replied","like-of":"liked","repost-of":"reposted","bookmark-of":"bookmarked","mention-of":"mentioned",rsvp:"RSVPed","follow-of":"followed"},k={"in-reply-to":"💬","like-of":"❤️","repost-of":"🔄","bookmark-of":"⭐️","mention-of":"💬",rsvp:"📅","follow-of":"🐜"},f={yes:"✅",no:"❌",interested:"💡",maybe:"💭"};function c(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function n(a){var d=c(a.author&&a.author.name?a.author.name:a.url.split("/")[2]),e=h[a["wm-property"]]||"reacted",b='<a class="reaction" rel="nofollow ugc" title="'+d+" "+e+'" href="'+a[g]+'">';return a.author&&a.author.photo&&(b+='<img src="'+c(a.author.photo)+'">'),b+=k[a["wm-property"]]||"💥",a.rsvp&&f[a.rsvp]&&(b+="<sub>"+f[a.rsvp]+"</sub>"),b+="</a>",b}function d(a){return a.substr(a.indexOf("//"))}function p(c){var a=[],b={};return c.forEach(function(c){var e=d(c.url);b[e]||(a.push(c),b[e]=!0)}),a}function q(d){var a="<h2>"+d.length+" Response"+(d.length>1?"s":"")+'</h2><ul class="comments">';return d.forEach(function(d){var f,h,i,e;a+="<li>",a+=n(d),a+=' <a class="source" rel="nofollow ugc" href="'+d[g]+'">',d.author&&d.author.name?a+=c(d.author.name):a+=c(d.url.split("/")[2]),a+="</a>: ",d.name?(f="name",h=d.name):d.content&&d.content.text?(i=c(d.content.text),b&&(e=i.replace(/\s+/g," ").split(" ",b+1),e.length>b&&(e[b-1]+="&hellip;",e=e.slice(0,b),i=e.join(" "))),f="text",h=i):(f="name",h="(mention)"),a+='<span class="'+f+'">'+h+"</span>",a+="</li>"}),a+="</ul>",a}function r(a){var b="<h2>"+a.length+" Reaction"+(a.length>1?"s":"")+'</h2><ul class="reacts">';return a.forEach(function(a){b+=n(a)}),b}function s(c,a){if(window.fetch)window.fetch(c).then(function(a){return a.status>=200&&a.status<300?Promise.resolve(a):Promise.reject(new Error(a.statusText))}).then(function(a){return a.json()}).then(a).catch(function(a){console.error("Request failed",a)});else{var b=new XMLHttpRequest;b.onload=function(b){a(JSON.parse(b))},b.onerror=function(a){console.error("Request failed",a)}}}window.addEventListener("load",function(){var a=document.getElementById(m),b,c;if(!a)return;b=[d(o)],!e||e.split("|").forEach(function(a){b.push(d(a))}),c="https://webmention.io/api/mentions.jf2?per-page="+l+"&sort-by="+j+"&sort-dir="+i,b.forEach(function(a){c+="&target[]="+encodeURIComponent("http:"+a)+"&target[]="+encodeURIComponent("https:"+a)}),s(c,function(e){var d="",b=[],c=[],f={"in-reply-to":b,"like-of":c,"repost-of":c,"bookmark-of":c,"mention-of":b,rsvp:b};e.children.forEach(function(a){var b=f[a["wm-property"]];b&&b.push(a)}),b.length>0&&(d+=q(p(b))),c.length>0&&(d+=r(p(c))),a.innerHTML=d})})})()